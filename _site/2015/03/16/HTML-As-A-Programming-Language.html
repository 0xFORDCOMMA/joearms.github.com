<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="author" content="Joe Armstrong" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    
    <title>HTML as a programming language</title>
    
    <!-- Bootstrap -->
    <link href="/css/bootstrap.min.css" rel="stylesheet" media="screen" />
    <link href="/css/bootstrap-responsive.min.css" rel="stylesheet" />
    <!-- syntax highlighting CSS -->
    <link rel="stylesheet" href="/css/syntax.css" type="text/css" />
    <!-- RSS -->
    <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml" />
    <link rel="stylesheet" href="/css/screen.css" type="text/css" 
	  media="screen, projection" />
  </head>

  <body>
    <div class="navbar">
      <div class="navbar-inner">
	<a class="brand" href="/index.html">Joe Armstrong - Erlang and other stuff</a>
	<ul class="nav">
	  <li><a href="/index.html">Home</a></li>
	  <li><a href="/archive.html">Archive</a></li>
	  <li><a href="/resources.html">Resources</a></li>
	  <li><a href="/installing.html">Installing</a></li>
	  <li><a href="/links.html">Links</a></li>
	  <li><a href="https://github.com/joearms/joearms.github.com/">Source</a></li>
	</ul>
      </div>
    </div>
    
    <div class="customize">
      <div class="row-fluid">
	<div class="span7 offset1">
	  <div>
  <div id="title">
  
    <h1>HTML as a programming language</h1>
    <span class="meta">16 Mar 2015</span>
    <p></p>
  </div>

  <div id="content">
    <p>Subtitle: Unifying HTML with Erlang.</p>

<p>HTML is a <strong>layout</strong> language not a <strong>programming language.</strong> 
With a few simple additions we can restructure HTML to make it into a
programming language.</p>

<h1 id="step-1---adding-structure-to-html">Step 1 - Adding structure to HTML</h1>

<p>HTML has a flat structure. In order to turn HTML into a programming
language we have break the HTML file into named sections.</p>

<p>This is easy. The first figure shows some HTML before and after 
the addition of a sectioning statement.</p>

<p><img src="/images/html1.png" /></p>

<p>The statements <code class="highlighter-rouge">@function{lorem}</code> and <code class="highlighter-rouge">@function{grumpy}</code> break the HTML 
file into named sections. We’ll see later how each named section 
is compiled into a single Erlang function.</p>

<h1 id="step-2---calling-html">Step 2 - Calling HTML</h1>

<p>Now that we have split the original HTML file into sections we can
``call’’ the sections from other sections of HTML. Here’s an example
where we call code in <code class="highlighter-rouge">one.html</code> from <code class="highlighter-rouge">two.html</code>.</p>

<p><img src="/images/html2.png" /></p>

<p>The syntax <code class="highlighter-rouge">&lt;? one:lorem(In) ?&gt;</code> means replace the <code class="highlighter-rouge">&lt;?...?&gt;</code> construct
with the contents of the section <code class="highlighter-rouge">lorem</code> in <code class="highlighter-rouge">one.html</code>.</p>

<p>When we <em>evaluate</em> <code class="highlighter-rouge">two:main(Env)</code> we get:</p>

<p><img src="/images/html2a.png" /></p>

<h1 id="whats-inside-the-funny-brackets">What’s inside the funny brackets?</h1>

<p>What’s inside the <code class="highlighter-rouge">&lt;? ... ?&gt;</code> brackets – Well since I like Erlang,
I’ll let you into a secret, it’s just plain Erlang code. No need to
invent yet another templating language when Erlang is at hand.</p>

<p>So to include 10 paragraphs of filler text I’d write:</p>

<p><img src="/images/html3.png" /></p>

<h1 id="everything-is-just-a-function">Everything is just a function</h1>

<p>The nice thing about the transformation to Erlang is that
all HTML fragments become Erlang functions after transformation.</p>

<p>The transformation of HTML into Erlang is as follows:</p>

<p><img src="/images/html4.png" /></p>

<p>The input file <code class="highlighter-rouge">one.html</code> is transformed into an Erlang module <code class="highlighter-rouge">one.erl</code>.
Each HTML fragment is transformed into a single Erlang function with the
same name as the fragment name.</p>

<p>HTML code is transformed into an Erlang map of the form <code class="highlighter-rouge">#{html =&gt;
"..."}</code> Erlang code is transformed into a sequence of forms each of
which returns a map.</p>

<p>Finally all the maps are combined
and a module is created with the same name as the HTML page.</p>

<h1 id="adding-jscsserlang">Adding JS/CSS/ERlang</h1>

<p>The next step is to extend this so we can deal with Erlang, Javascript
and CSS in a uniform manner:</p>

<p>Here’s an example:</p>

<p><img src="/images/html5.png" /></p>

<p>We don’t need to do anything special with Javascript and CSS. The
parameter passing mechanism works as expected so we can pass parameters
into CSS. So for example the parameter <code class="highlighter-rouge">"red"</code> gets bound to the variable
<code class="highlighter-rouge">In</code> and expanded in the body of the CSS definition. The added function
<code class="highlighter-rouge">to_string(X)</code> converts its argument to a map.</p>

<p>Erlang functions are written following a <code class="highlighter-rouge">@erlang</code> annotation, as in
the example. All we have to remember is that functions that are called
from HTML functions must return an object of type <code class="highlighter-rouge">#{html =&gt; ...}</code></p>

<h1 id="efficiency">Efficiency</h1>

<p>I haven’t mention efficiency. My plan is to <strong>make if right then make
it fast</strong>. Right now this is just a proof of concept. On the other
hand I expect this to be efficient. Once transformed and loaded HTML
functions become compiled Erlang code which is pretty fast. So I
expect this to be blindingly efficient - the file system never gets
touched, everything is compiled and efficient management of concurrent
session is built into the virtual machine.</p>

<h1 id="about">About</h1>

<p>As I said this is a proof of concept- I wrote this article to
accompany <a href="http://www.meetup.com/ErlangSF/events/220955245/">a talk I’m
giving</a> in a couple
of weeks time.</p>

<p>The code has not yet been published - I have a prototype that works and
I’ll publish it when it’s sufficiently mature.</p>

<h1 id="what-else-is-in-the-map">What else is in the map?</h1>

<p>So far the examples show a return value of <code class="highlighter-rouge">#{html =&gt; "..."}</code>. Two more keys
are planned.</p>

<p><code class="highlighter-rouge">#{headers =&gt; [{Key,Value}]}</code> adds some headers to the map. <code class="highlighter-rouge">#{once =&gt; [Name]}</code>
adds a fragment <code class="highlighter-rouge">Name</code> to the map (this is equivalent to calling
<code class="highlighter-rouge">&lt;? Name(In) ?&gt;</code> but it’s only done once. This is so we include
CSS and JS code once only. If several fragments use the same CSS styles
we only want the styles to be included once.</p>


  </div>

  <div id="tags">
    Tagged:
    
    <a href="/blog/tag/HTML">HTML</a> &nbsp;
    
    <a href="/blog/tag/programming">programming</a> &nbsp;
    
    <a href="/blog/tag/erlang">erlang</a> &nbsp;
    
  </div>
  <p></p>

  <hr />
  
  <!-- the tweet button -->
  <p>
    <a href="https://twitter.com/share"  class="twitter-share-button" 
       data-url="http://joearms.github.com/2015/03/16/HTML-As-A-Programming-Language.html">Tweet</a>
  </p>
  
  <script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script>
  <!-- end of tweet button -->

  <p>Comments:</p>
  
  <div id="disqus">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
      // var disqus_developer = 1;
      var disqus_shortname = 'joearmstrongsblog';
      var disqus_identifier = '/2015/03/16/HTML-As-A-Programming-Language';
      var disqus_url = 'http://joearms.github.com/2015/03/16/HTML-As-A-Programming-Language.html';
      (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
  </div>
  
  <noscript>
    Please enable JavaScript to view the <a
    href="http://disqus.com/?ref_noscript">comments powered by
    Disqus.</a>
  </noscript>
</div>

	</div>
	<div class="span3">
	  
	</div>
      </div>
    </div>
    
    <!-- Footer  ==================================== -->
    <footer class="footer">
      <div class="container">
	<p>&copy; 2013 Joe Armstrong</p>
	  Theme and code from <a href="https://github.com/mojombo">Tom
	  Preston-Werner</a>.<br /> Hosted by <a
	  href="https://github.com/networc/networc.github.com/">GitHub</a>
	  and powered by <a
	  href="https://github.com/mojombo/jekyll">Jekyll</a>.
	  Source code <a href="https://github.com/joearms/joearms.github.com">here</a>.
	</p>
	<p>
	  joearms@gmail.com <a href="http://github.com/joearms/">github.com/joearms</a>
	  <a href="http://twitter.com/joeerl/">twitter.com/joeerl</a>
	</p>
      </div>
    </footer>

    <script src="http://code.jquery.com/jquery-latest.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>

    <!-- Google Analytics -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      
      ga('create', 'UA-39670657-1', 'github.com');
      ga('send', 'pageview');
    </script>
    <!-- Google Analytics end -->
    
  </body>
</html>
