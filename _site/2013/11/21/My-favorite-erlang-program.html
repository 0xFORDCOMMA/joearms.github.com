<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="author" content="Joe Armstrong" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    
    <title>My favorite Erlang program</title>
    
    <!-- Bootstrap -->
    <link href="/css/bootstrap.min.css" rel="stylesheet" media="screen" />
    <link href="/css/bootstrap-responsive.min.css" rel="stylesheet" />
    <!-- syntax highlighting CSS -->
    <link rel="stylesheet" href="/css/syntax.css" type="text/css" />
    <!-- RSS -->
    <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml" />
    <link rel="stylesheet" href="/css/screen.css" type="text/css" 
	  media="screen, projection" />
  </head>

  <body>
    <div class="navbar">
      <div class="navbar-inner">
	<a class="brand" href="/index.html">Joe Armstrong - Erlang and other stuff</a>
	<ul class="nav">
	  <li><a href="/index.html">Home</a></li>
	  <li><a href="/archive.html">Archive</a></li>
	  <li><a href="/resources.html">Resources</a></li>
	  <li><a href="/installing.html">Installing</a></li>
	  <li><a href="/links.html">Links</a></li>
	  <li><a href="https://github.com/joearms/joearms.github.com/">Source</a></li>
	</ul>
      </div>
    </div>
    
    <div class="customize">
      <div class="row-fluid">
	<div class="span7 offset1">
	  <div>
  <div id="title">
  
    <h1>My favorite Erlang program</h1>
    <span class="meta">21 Nov 2013</span>
    <p></p>
  </div>

  <div id="content">
    <p>The other day I got a mail from Dean Galvin from Rowan University.
Dean was doing an Erlang project so he asked ``What example program
would best exemplify Erlang’’.</p>

<p>He wanted a small program, that would be suitable for a ten minute
talk that would best show off the language.  I thought for a while
… and quickly wrote my favorite program, it’s the ``Universal
server’’.</p>

<h1 id="the-universal-server">The Universal Server</h1>

<p>Normally servers do something. An HTTP server responds to HTTP
requests and FTP server responds to FTP request and so on. But what
about a <strong>Universal Server</strong>? surely we can generalize the idea of a
server and make a universal server that which we can later tell to
become a specific sever.</p>

<p>Here’s my universal server:</p>

<figure class="highlight"><pre><code class="language-erlang" data-lang="erlang"><span class="nf">universal_server</span><span class="p">()</span> <span class="o">-&gt;</span>
    <span class="k">receive</span>
       <span class="p">{</span><span class="n">become</span><span class="p">,</span> <span class="nv">F</span><span class="p">}</span> <span class="o">-&gt;</span>
           <span class="nv">F</span><span class="p">()</span>
    <span class="k">end</span><span class="p">.</span></code></pre></figure>

<p>That was pretty easy. Once I have created a universal serve it just sits and
waits for a <strong>{become, F}</strong> message and then it becomes an <strong>F</strong> server.</p>

<h1 id="the-factorial-server">The Factorial Server</h1>

<p>A factorial server is a server which waits for an integer and sends back the
factorial of an integer. This is mind-bogglingly simple:</p>

<figure class="highlight"><pre><code class="language-erlang" data-lang="erlang"><span class="nf">factorial_server</span><span class="p">()</span> <span class="o">-&gt;</span>
    <span class="k">receive</span>
       <span class="p">{</span><span class="nv">From</span><span class="p">,</span> <span class="nv">N</span><span class="p">}</span> <span class="o">-&gt;</span>
           <span class="nv">From</span> <span class="o">!</span> <span class="nf">factorial</span><span class="p">(</span><span class="nv">N</span><span class="p">),</span>
           <span class="nf">factorial_server</span><span class="p">()</span>
    <span class="k">end</span><span class="p">.</span>

<span class="nf">factorial</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="mi">1</span><span class="p">;</span>
<span class="nf">factorial</span><span class="p">(</span><span class="nv">N</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nv">N</span> <span class="o">*</span> <span class="nf">factorial</span><span class="p">(</span><span class="nv">N</span><span class="o">-</span><span class="mi">1</span><span class="p">).</span></code></pre></figure>

<p>Now we’re ready to rock and roll …</p>

<h1 id="putting-it-all-together">Putting it all together</h1>

<p>I’ll write a little function that creates a universal server
sends it a ``become a factorial server’’ message, then I’ll sent 
it an integer, wait for the response and print the response:</p>

<figure class="highlight"><pre><code class="language-erlang" data-lang="erlang"><span class="nf">test</span><span class="p">()</span> <span class="o">-&gt;</span>
    <span class="nv">Pid</span> <span class="o">=</span> <span class="nb">spawn</span><span class="p">(</span><span class="k">fun</span> <span class="n">universal_server</span><span class="o">/</span><span class="mi">0</span><span class="p">),</span>
    <span class="nv">Pid</span> <span class="o">!</span> <span class="p">{</span><span class="n">become</span><span class="p">,</span> <span class="k">fun</span> <span class="n">factorial_server</span><span class="o">/</span><span class="mi">0</span><span class="p">},</span>
    <span class="nv">Pid</span> <span class="o">!</span> <span class="p">{</span><span class="nf">self</span><span class="p">(),</span> <span class="mi">50</span><span class="p">},</span>
    <span class="k">receive</span>
        <span class="nv">X</span> <span class="o">-&gt;</span> <span class="nv">X</span>
    <span class="k">end</span><span class="p">.</span></code></pre></figure>

<p>All these functions belong to the module <a href="/code/fav1.erl">fav1</a>.</p>

<p>Now all we have to do is fire up an Erlang shell and run the test program</p>

<figure class="highlight"><pre><code class="language-erlang" data-lang="erlang"><span class="sc">$ </span><span class="n">erl</span>
<span class="mi">1</span> <span class="o">&gt;</span> <span class="nf">c</span><span class="p">(</span><span class="n">fav1</span><span class="p">).</span>
<span class="p">{</span><span class="n">ok</span><span class="p">,</span> <span class="n">fav1</span><span class="p">}</span>
<span class="mi">2</span> <span class="o">&gt;</span> <span class="nn">fav1</span><span class="p">:</span><span class="nf">test</span><span class="p">().</span>
<span class="mi">30414093201713378043612608166064768844377641568960512000000000000</span></code></pre></figure>

<h1 id="aside">Aside</h1>

<p>A few years ago when I was at SICS I had access to <a href="http://www.planet-lab.org/">Planet
Lab</a>.  Planet Lab is a research network of
9000 computers. Joining Planet Lab is easy, all you have to do is buy
a standard PC, connect it to the network and donate it’s use to the
Planet Lab organization. Having donated you machine to the network, in
return you can use all the other machines in planet lab.</p>

<p>Planet lab is a real-world test-bed for distributed applications, it
currently has 1171 nodes at 562 sites.</p>

<p>What was I going to do with planet lab? I didn’t have a clue.  What I
ended up doing was making some scripts to install empty universal
Erlang servers on all the Planet lab machines (pretty much like the
code in this article) - then I set up a gossip algorithm to flood the
network with <strong>become</strong> messages. Then I had an empty network that in a
few seconds would become anything I wanted it to do.</p>

<p>About a year later I had to write a paper. One of the disadvantages of
being a researcher is that in order to get money you have to write a
paper about something or other, the paper is never about what
currently interests you at the moment, but must be about what the
project that financed your research expects to read about.</p>

<p>Well I had my gossip network setup on planet lab and I could tell it
to become anything, so I told it to become a content distribution
networks and used a gossip algorithm to make copies of the same file
on all machine on the network and wrote a paper about it and everybody
was happy.</p>


  </div>

  <div id="tags">
    Tagged:
    
    <a href="/blog/tag/erlang">erlang</a> &nbsp;
    
  </div>
  <p></p>

  <hr />
  
  <!-- the tweet button -->
  <p>
    <a href="https://twitter.com/share"  class="twitter-share-button" 
       data-url="http://joearms.github.com/2013/11/21/My-favorite-erlang-program.html">Tweet</a>
  </p>
  
  <script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script>
  <!-- end of tweet button -->

  <p>Comments:</p>
  
  <div id="disqus">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
      // var disqus_developer = 1;
      var disqus_shortname = 'joearmstrongsblog';
      var disqus_identifier = '/2013/11/21/My-favorite-erlang-program';
      var disqus_url = 'http://joearms.github.com/2013/11/21/My-favorite-erlang-program.html';
      (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
  </div>
  
  <noscript>
    Please enable JavaScript to view the <a
    href="http://disqus.com/?ref_noscript">comments powered by
    Disqus.</a>
  </noscript>
</div>

	</div>
	<div class="span3">
	  
	</div>
      </div>
    </div>
    
    <!-- Footer  ==================================== -->
    <footer class="footer">
      <div class="container">
	<p>&copy; 2013 Joe Armstrong</p>
	  Theme and code from <a href="https://github.com/mojombo">Tom
	  Preston-Werner</a>.<br /> Hosted by <a
	  href="https://github.com/networc/networc.github.com/">GitHub</a>
	  and powered by <a
	  href="https://github.com/mojombo/jekyll">Jekyll</a>.
	  Source code <a href="https://github.com/joearms/joearms.github.com">here</a>.
	</p>
	<p>
	  joearms@gmail.com <a href="http://github.com/joearms/">github.com/joearms</a>
	  <a href="http://twitter.com/joeerl/">twitter.com/joeerl</a>
	</p>
      </div>
    </footer>

    <script src="http://code.jquery.com/jquery-latest.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>

    <!-- Google Analytics -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      
      ga('create', 'UA-39670657-1', 'github.com');
      ga('send', 'pageview');
    </script>
    <!-- Google Analytics end -->
    
  </body>
</html>
