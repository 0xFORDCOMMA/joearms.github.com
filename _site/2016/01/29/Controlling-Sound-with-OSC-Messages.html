<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="author" content="Joe Armstrong" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    
    <title>Controlling Sound with OSC Messages</title>
    
    <!-- Bootstrap -->
    <link href="/css/bootstrap.min.css" rel="stylesheet" media="screen" />
    <link href="/css/bootstrap-responsive.min.css" rel="stylesheet" />
    <!-- syntax highlighting CSS -->
    <link rel="stylesheet" href="/css/syntax.css" type="text/css" />
    <!-- RSS -->
    <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml" />
    <link rel="stylesheet" href="/css/screen.css" type="text/css" 
	  media="screen, projection" />
  </head>

  <body>
    <div class="navbar">
      <div class="navbar-inner">
	<a class="brand" href="/index.html">Joe Armstrong - Erlang and other stuff</a>
	<ul class="nav">
	  <li><a href="/index.html">Home</a></li>
	  <li><a href="/archive.html">Archive</a></li>
	  <li><a href="/resources.html">Resources</a></li>
	  <li><a href="/installing.html">Installing</a></li>
	  <li><a href="/links.html">Links</a></li>
	  <li><a href="https://github.com/joearms/joearms.github.com/">Source</a></li>
	</ul>
      </div>
    </div>
    
    <div class="customize">
      <div class="row-fluid">
	<div class="span7 offset1">
	  <div>
  <div id="title">
  
    <h1>Controlling Sound with OSC Messages</h1>
    <span class="meta">29 Jan 2016</span>
    <p></p>
  </div>

  <div id="content">
    <p>In earlier articles I have talked about 
<a href="http://joearms.github.io/2016/01/27/Controlling-Live-Music.html">Controlling Live Music</a>
and
<a href="http://joearms.github.io/2016/01/28/A-Badass-Way-To-Connect-Programs-Together.html">A Badass Way to Connect Programs Together</a></p>

<p>In this article I’ll show how I have interfaced Erlang to the
<a href="http://sonic-pi.net/">Sonic Pi</a>, the
<a href="http://www.audiosynth.com/">SuperCollider</a> and
<a href="https://puredata.info/">Pure Data</a>.</p>

<p>The code for described here is available at
https://github.com/joearms/music_experiments</p>

<p>The code I’m described is at ``proof of concept’’ stage - you can
download it and run it - but there are no build instructions, so
familiarity with Erlang/OSC and the target systems is implied.</p>

<h1 id="act1--connecting-sonic-pi-to-erlang">Act1 : Connecting Sonic PI to Erlang.</h1>

<p>This all started when Sam Arron showed me how to do remotely control
Sonic Pi.</p>

<blockquote>
  <p><code class="highlighter-rouge">It's easy,'' he said</code><span style="color:red">Just open port 4557 and send it
a run_code message</span>.’’ Actually he didn’t say <em>exactly</em> this
but he might say this if I asked again.</p>
</blockquote>

<p>So it’s really really easy. Any of the programs you see in a sonic pi window
can be turned into a fragment of Erlang code</p>

<p>Here’s a very simple program in Sonic Pi:</p>

<p><img src="/images/sonic_pi.png" /></p>

<p>To run this in Sonic Pi you just press the run button, and you’ll hear
a noise.</p>

<p>Here’s the code to do the same thing in Erlang:</p>

<p>````
test1() -&gt;
    run_code(“use_synth :fm\nplay 50\n”).</p>

<p>run_code(Prog) -&gt;
    %% Prog is a io-list
    P1 = lists:flatten(Prog),
    M = [“/run-code” , “erl-id”, P1],
    E = osc:encode(M),
    {ok, Socket} = gen_udp:open(0,[binary]),
    ok = gen_udp:send(Socket, “localhost”, 4557, E),
    gen_udp:close(Socket).
````</p>

<p>The entire program is in
<a href="https://github.com/joearms/music_experiments/blob/master/sonic.erl">sonic.erl</a>
the OSC encoder
is in 
<a href="https://github.com/joearms/music_experiments/blob/master/osc.erl">osc.erl</a>.</p>

<p><strong>Fantastic</strong> I say.</p>

<blockquote>
  <p>Note: I can collaborate with the Sonic PI without messing in the
Sonic Pi source code tree - all I do is send it messages that it understands.</p>
</blockquote>

<h1 id="act2--connecting-the-supercollider-to-erlang">Act2 : Connecting The SuperCollider to Erlang.</h1>

<p>Having connected the Sonic Pi to Erlang I started idly wondering
``How does the Sonic Pi actually make sounds? does it do it itself
or does in use some other code to do this’’ - I downloaded the
sources to find out - the documentation doesn’t say.</p>

<p>Low and behold the Sonic Pi makes sounds by sending OSC-over-UDP
messages to the SuperCollider. I say the SuperCollider here, since
this is the name of the program you have to download to perform these
experiments. But actually the SuperCollider itself is actually two
programs, which communicate by (guess what) OSC-over-UDP.</p>

<p>A program called <code class="highlighter-rouge">scsynth</code> which is part of the SuperCollider program
generates the actual sounds. ``Why is it done this way?’’ you’re probably asking.
It’s because the author of the SuperCollider wanted to separate the program
into a real-time part (<code class="highlighter-rouge">scsynth</code>) and a control part (which has less stringent control
problems) - the music should play (via <code class="highlighter-rouge">scsynth</code>) even if the controller is
busy or crashed for a short time - a very nice design.</p>

<p>Sam kindly told me how to trace the OSC messages to the SuperCollider
and I turned this into an Erlang program.</p>

<p>So to control the SuperCollider I open UDP port 4556 and send it a
stream of OSC messages - ie I’m doing exactly what the Sonic Pi did,
only I’m doing it from Erlang and without the user interface.</p>

<p>The code is in
<a href="https://github.com/joearms/music_experiments/blob/master/sc.erl">sc.erl</a>
All I’ve done is start a <code class="highlighter-rouge">scsynth</code> server listening to port 4556
(this is done in
<a href="https://github.com/joearms/music_experiments/blob/master/start_scsynth.sh">start_scsynth.sh</a>) and send it a load of OSC commands.</p>

<p>Working in the SuperCollider was an eye opener. It a REPL <em>without</em> a terminal
and is similar to the Plan9
<a href="https://en.wikipedia.org/wiki/Acme_%28text_editor%29">ACME</a> shell/editor.</p>

<p>I’d read about ACME but never experienced it.  It’s a Visceral
experience. <strong>You never type code twice</strong>. If it’s on the screen you
click it, the answer appears ``somewhere else’’.</p>

<p>Interestingly <code class="highlighter-rouge">Pure data</code> makes exactly the same design decision.</p>

<p>Why why why? Because it’s faster to interact with. No typing just
clicking - this is important for live performance.  Musicians
instruments are not laptops with keyboards - they are things you can
hit and stroke.</p>

<h1 id="act-3---pure-data">Act 3 - Pure Data</h1>

<p>Finally <a href="https://puredata.info/">Pure Data</a>. PD programs have no
textual representation, there is only a graphic interface to a data-flow language.</p>

<p>The program is in https://github.com/joearms/music_experiments/blob/master/pd_osc.pd:</p>

<p><img src="/images/pd_osc.png" /></p>

<p>The Erlang code
<a href="https://github.com/joearms/music_experiments/blob/master/pd.erl">pd.erl</a>
is extremely simple:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>play(N) -&gt; run_code(["/playNote", N]).

run_code(M) -&gt;
    E = osc:encode(M),
    {ok, Socket} = gen_udp:open(0,[binary]),
    ok = gen_udp:send(Socket, "localhost", 6677, E),
    gen_udp:close(Socket).
</code></pre>
</div>


  </div>

  <div id="tags">
    Tagged:
    
    <a href="/blog/tag/OSC">OSC</a> &nbsp;
    
    <a href="/blog/tag/Networking">Networking</a> &nbsp;
    
  </div>
  <p></p>

  <hr />
  
  <!-- the tweet button -->
  <p>
    <a href="https://twitter.com/share"  class="twitter-share-button" 
       data-url="http://joearms.github.com/2016/01/29/Controlling-Sound-with-OSC-Messages.html">Tweet</a>
  </p>
  
  <script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script>
  <!-- end of tweet button -->

  <p>Comments:</p>
  
  <div id="disqus">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
      // var disqus_developer = 1;
      var disqus_shortname = 'joearmstrongsblog';
      var disqus_identifier = '/2016/01/29/Controlling-Sound-with-OSC-Messages';
      var disqus_url = 'http://joearms.github.com/2016/01/29/Controlling-Sound-with-OSC-Messages.html';
      (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
  </div>
  
  <noscript>
    Please enable JavaScript to view the <a
    href="http://disqus.com/?ref_noscript">comments powered by
    Disqus.</a>
  </noscript>
</div>

	</div>
	<div class="span3">
	  
	</div>
      </div>
    </div>
    
    <!-- Footer  ==================================== -->
    <footer class="footer">
      <div class="container">
	<p>&copy; 2013 Joe Armstrong</p>
	  Theme and code from <a href="https://github.com/mojombo">Tom
	  Preston-Werner</a>.<br /> Hosted by <a
	  href="https://github.com/networc/networc.github.com/">GitHub</a>
	  and powered by <a
	  href="https://github.com/mojombo/jekyll">Jekyll</a>.
	  Source code <a href="https://github.com/joearms/joearms.github.com">here</a>.
	</p>
	<p>
	  joearms@gmail.com <a href="http://github.com/joearms/">github.com/joearms</a>
	  <a href="http://twitter.com/joeerl/">twitter.com/joeerl</a>
	</p>
      </div>
    </footer>

    <script src="http://code.jquery.com/jquery-latest.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>

    <!-- Google Analytics -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      
      ga('create', 'UA-39670657-1', 'github.com');
      ga('send', 'pageview');
    </script>
    <!-- Google Analytics end -->
    
  </body>
</html>
